language: go

addons:
  apt:
    packages:
    # needed for goreleaser/nfpm:
    - rpm

# uncomment below if docker builds are enabled in .goreleaser.yaml
# services:
# - docker

script:
  - go test -v ./...
  - go test -cover -race ./...
  - go vet ./...

sudo: false

# calls goreleaser
deploy:
- provider: script
  skip_cleanup: true
  # TODO(joe): if we use autotag for releaes, install it here
  script: curl -sL https://git.io/goreleaser | bash
  on:
    tags: true
    # TODO(joe): remove branch filters if we go with the manual-tag release method
    # branch: master
    # branch: goreleaser
    condition: $TRAVIS_OS_NAME = linux